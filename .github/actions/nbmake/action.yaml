name: nbmake
description: Test the execution of notebook-based documentation located in a given directory.
inputs:
  dir:
    required: true
    description: 'Directory of the notebooks (relative to project root directory)'
runs:
  using: "composite"
  steps:
    - name: Check out the repo
      uses: actions/checkout@v4
    - name: Call the shared steps of documentation
      uses: ./.github/actions/shared-steps
    - name: Execute the notebooks
      id: execute
      shell: bash
      run: |
        string="${{ inputs.dir }}"
        result=$(echo "$string" | sed 's|./docs/||; s|/|-|g')
        pytest --junitxml=report-notebooks-$result.xml -vvv --nbmake "${{ inputs.dir }}"
        echo "outfile=$result" >> $GITHUB_OUTPUT
    - name: Upload the report
      uses: actions/upload-artifact@v3
      with:
        path: ./report-notebooks-${{ steps.execute.outputs.outfile }}.xml